import dayjs from "dayjs";
import { admin, bucket, collectionNames } from "../config/firebase.js";
import axios from "axios";
import { v4 as uuidv4 } from "uuid";
import { streamToPromise } from "../services/storage/firebase.service.js";
import { getArrayFromString } from "../utils/index.js";
import { getMissingElements } from "../utils/array.js";
import sendEmail from "../services/email.servce.js";
import { emailTypes } from "../resources/types/index.js";
export async function updateDb(req, res) {
  try {
    // const result = (await admin.firestore().collection(collectionNames.projects).get()).docs;

    // const response = [];
    // for (let index = 0; index < result.length; index++) {
    //   const data = result[index].data();
    //   const client = (
    //     await admin.firestore().collection(collectionNames.users).doc(data.clientId).get()
    //   ).data();
    //   response.push({
    //     ...data,
    //     client,
    //     created: data?.created?.toDate(),
    //     updated: data?.created?.toDate(),
    //   });
    // await admin.firestore().collection(collectionNames.updates).doc(response[index].id).update({
    //   location: project.location,
    // });
    // }

    // return res.json({
    //   response,
    // });

    const response = (await admin.firestore().collection(collectionNames.users).get()).docs;

    return res.json({
      response,
    });
  } catch (error) {
    console.log(error);
    return res.json(error);
  }
}

const uploadBufferToStorage = async (fileName, bufferData, type) => {
  const file = bucket.file(fileName);

  const response = await file.save(bufferData, {
    metadata: {
      contentType: type,
      metadata: {
        firebaseStorageDownloadTokens: uuidv4(),
      },
    },
  });

  return file;
};

const getMetadata = async (fileName) => {
  const file = bucket.file(fileName);

  const [metadata] = await file.getMetadata();
  return metadata;
};

const buffer = {
  type: "Buffer",
  data: [
    137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 1, 1, 0, 0, 0, 71, 8, 3, 0,
    0, 0, 48, 68, 2, 10, 0, 0, 1, 161, 80, 76, 84, 69, 0, 0, 0, 255, 255, 255, 153, 151, 138, 123,
    122, 114, 151, 151, 135, 159, 159, 128, 253, 238, 161, 153, 150, 138, 152, 151, 138, 153, 151,
    137, 153, 151, 138, 154, 151, 139, 153, 152, 137, 149, 149, 138, 154, 152, 138, 153, 151, 137,
    152, 151, 138, 153, 150, 139, 151, 147, 135, 154, 154, 142, 153, 153, 140, 153, 151, 139, 153,
    150, 137, 151, 149, 135, 206, 205, 202, 151, 151, 139, 222, 221, 219, 122, 122, 114, 239, 239,
    238, 153, 150, 138, 120, 120, 112, 154, 151, 138, 188, 180, 137, 159, 159, 143, 247, 247, 246,
    140, 139, 131, 152, 149, 138, 156, 156, 140, 154, 150, 138, 122, 122, 114, 123, 122, 114, 152,
    152, 137, 151, 149, 138, 155, 152, 139, 122, 121, 114, 172, 166, 131, 196, 187, 140, 122, 121,
    113, 153, 150, 137, 153, 150, 137, 122, 122, 114, 112, 112, 112, 124, 123, 114, 123, 121, 113,
    151, 151, 138, 149, 149, 133, 237, 224, 155, 128, 112, 112, 197, 196, 193, 204, 194, 143, 189,
    188, 184, 153, 150, 140, 153, 153, 139, 123, 122, 115, 153, 150, 134, 123, 123, 114, 173, 172,
    167, 230, 230, 228, 173, 172, 166, 123, 121, 114, 148, 147, 140, 156, 155, 149, 220, 209, 149,
    139, 136, 120, 154, 151, 138, 152, 152, 140, 124, 123, 115, 153, 151, 138, 214, 213, 211, 148,
    144, 123, 122, 121, 112, 117, 117, 112, 122, 121, 113, 128, 128, 112, 181, 181, 176, 180, 173,
    134, 153, 153, 137, 124, 124, 116, 128, 120, 112, 164, 163, 158, 153, 152, 139, 212, 202, 146,
    121, 121, 113, 155, 151, 126, 172, 168, 144, 153, 149, 135, 179, 178, 174, 132, 131, 123, 150,
    150, 137, 121, 121, 112, 245, 231, 158, 155, 151, 125, 164, 158, 129, 151, 151, 135, 154, 154,
    138, 128, 122, 112, 124, 124, 114, 123, 119, 113, 124, 122, 114, 153, 152, 138, 188, 187, 178,
    123, 123, 114, 143, 143, 136, 131, 130, 123, 144, 144, 138, 156, 155, 150, 160, 159, 153, 164,
    163, 152, 141, 138, 120, 131, 129, 117, 158, 157, 152, 122, 122, 112, 167, 166, 160, 158, 154,
    127, 123, 123, 115, 142, 141, 134, 228, 216, 152, 153, 152, 146, 149, 149, 143, 152, 148, 139,
    139, 138, 126, 148, 144, 129, 153, 150, 140, 132, 131, 123, 124, 120, 112, 122, 122, 117, 124,
    124, 112, 153, 153, 137, 123, 123, 115, 39, 82, 60, 163, 0, 0, 0, 139, 116, 82, 78, 83, 0, 255,
    255, 255, 32, 16, 255, 239, 159, 223, 223, 191, 143, 48, 207, 127, 191, 239, 64, 63, 95, 127,
    112, 96, 255, 64, 255, 96, 255, 175, 32, 159, 255, 16, 255, 255, 111, 31, 63, 127, 159, 111, 96,
    79, 143, 255, 255, 223, 95, 80, 223, 16, 239, 95, 96, 48, 255, 16, 255, 255, 255, 95, 127, 191,
    80, 112, 255, 255, 255, 175, 255, 255, 255, 255, 144, 111, 111, 207, 255, 255, 127, 48, 207, 16,
    255, 255, 80, 64, 32, 255, 143, 255, 63, 255, 255, 128, 223, 223, 112, 80, 255, 255, 255, 64,
    48, 48, 79, 79, 128, 175, 255, 143, 207, 255, 191, 191, 223, 255, 223, 239, 239, 48, 191, 239,
    31, 223, 255, 143, 159, 79, 255, 255, 80, 239, 64, 48, 64, 95, 207, 177, 109, 19, 222, 0, 0, 5,
    148, 73, 68, 65, 84, 120, 156, 237, 154, 135, 87, 27, 55, 28, 199, 109, 73, 55, 236, 179, 207,
    171, 222, 123, 80, 12, 102, 20, 135, 80, 54, 165, 236, 81, 66, 67, 40, 132, 54, 105, 210, 164,
    217, 233, 222, 123, 175, 191, 186, 58, 29, 230, 97, 251, 134, 124, 167, 51, 15, 222, 125, 222,
    195, 152, 59, 161, 147, 190, 39, 253, 244, 251, 253, 36, 143, 139, 139, 139, 139, 139, 139, 139,
    139, 139, 139, 139, 75, 95, 224, 80, 52, 26, 69, 23, 221, 138, 139, 228, 4, 16, 138, 142, 84,
    142, 56, 242, 25, 143, 15, 79, 68, 201, 87, 3, 102, 178, 15, 102, 28, 105, 132, 62, 233, 87,
    148, 79, 180, 16, 139, 197, 22, 2, 67, 172, 107, 231, 134, 3, 82, 4, 0, 229, 107, 67, 21, 217,
    111, 168, 193, 242, 36, 132, 205, 235, 172, 91, 97, 68, 80, 2, 190, 206, 107, 9, 162, 9, 19,
    254, 0, 64, 8, 7, 106, 175, 158, 254, 57, 16, 107, 212, 68, 229, 11, 23, 212, 46, 127, 4, 171,
    179, 179, 171, 147, 215, 152, 53, 192, 12, 110, 27, 8, 161, 174, 119, 34, 1, 145, 149, 69, 64,
    53, 237, 174, 14, 1, 89, 83, 230, 165, 106, 197, 235, 245, 110, 236, 50, 122, 188, 41, 72, 6, 1,
    173, 49, 185, 8, 252, 118, 37, 72, 75, 224, 117, 131, 219, 229, 164, 15, 248, 187, 53, 56, 134,
    41, 44, 128, 55, 53, 104, 243, 233, 212, 136, 194, 27, 218, 55, 144, 79, 48, 106, 191, 41, 184,
    255, 26, 99, 171, 29, 172, 129, 216, 89, 228, 8, 42, 2, 120, 51, 125, 83, 192, 163, 219, 72, 44,
    129, 245, 81, 160, 216, 150, 154, 153, 205, 199, 44, 130, 95, 59, 174, 100, 215, 207, 20, 192,
    38, 113, 196, 114, 11, 88, 128, 108, 152, 130, 19, 223, 107, 116, 5, 187, 84, 202, 222, 38, 10,
    236, 61, 247, 212, 97, 21, 194, 125, 203, 77, 184, 180, 100, 223, 36, 10, 172, 22, 94, 220, 206,
    121, 115, 235, 206, 174, 9, 254, 128, 19, 181, 166, 237, 89, 208, 103, 170, 2, 159, 44, 207, 43,
    191, 42, 159, 190, 205, 166, 85, 154, 132, 0, 229, 72, 237, 5, 46, 15, 236, 233, 250, 148, 40,
    176, 50, 168, 10, 225, 93, 119, 80, 1, 4, 136, 99, 98, 204, 162, 212, 91, 165, 239, 68, 132,
    144, 165, 214, 156, 113, 176, 161, 116, 252, 94, 53, 167, 42, 112, 223, 94, 109, 134, 72, 62,
    138, 225, 154, 4, 189, 56, 135, 216, 187, 146, 117, 60, 61, 106, 142, 254, 156, 223, 171, 120,
    171, 25, 85, 128, 140, 131, 222, 113, 154, 110, 14, 200, 189, 12, 2, 236, 93, 89, 107, 12, 225,
    250, 238, 131, 108, 253, 251, 205, 135, 37, 120, 119, 227, 150, 42, 128, 247, 51, 27, 245, 153,
    33, 117, 197, 2, 154, 12, 129, 40, 125, 157, 201, 150, 243, 111, 137, 194, 56, 132, 37, 158,
    127, 23, 127, 252, 244, 37, 233, 127, 229, 94, 193, 78, 133, 38, 44, 210, 153, 193, 178, 224,
    200, 130, 161, 201, 83, 184, 197, 243, 211, 91, 143, 120, 190, 4, 63, 82, 166, 192, 207, 253,
    11, 143, 12, 16, 5, 170, 98, 28, 139, 64, 234, 99, 60, 4, 74, 112, 26, 255, 204, 141, 165, 102,
    191, 123, 143, 65, 149, 12, 104, 0, 10, 231, 22, 175, 1, 97, 6, 207, 202, 206, 241, 252, 214,
    40, 63, 7, 199, 120, 254, 171, 191, 179, 255, 48, 168, 178, 95, 132, 128, 204, 98, 12, 188, 24,
    227, 55, 241, 16, 192, 34, 240, 15, 111, 64, 120, 193, 81, 65, 15, 112, 69, 80, 164, 25, 40, 38,
    204, 44, 193, 59, 252, 216, 13, 34, 2, 255, 33, 22, 0, 194, 191, 236, 215, 170, 71, 90, 96, 208,
    228, 83, 112, 138, 193, 166, 23, 68, 56, 110, 222, 170, 204, 79, 151, 30, 41, 34, 224, 5, 129,
    128, 3, 196, 86, 198, 240, 113, 130, 193, 51, 206, 49, 12, 6, 152, 213, 213, 16, 108, 45, 130,
    167, 204, 252, 136, 157, 160, 202, 221, 195, 81, 190, 132, 39, 193, 161, 170, 64, 115, 164, 14,
    127, 80, 239, 39, 236, 167, 108, 218, 232, 65, 129, 32, 187, 148, 161, 17, 191, 16, 55, 120,
    229, 247, 81, 126, 12, 43, 160, 78, 2, 136, 87, 131, 111, 91, 5, 112, 58, 69, 51, 155, 101, 145,
    30, 20, 16, 253, 236, 30, 171, 79, 150, 228, 198, 176, 4, 191, 205, 205, 221, 217, 60, 252, 154,
    8, 48, 222, 86, 4, 157, 104, 101, 213, 172, 50, 108, 152, 194, 107, 227, 165, 129, 2, 92, 128,
    213, 200, 92, 58, 117, 131, 87, 170, 153, 84, 106, 189, 112, 128, 253, 67, 56, 62, 210, 17, 21,
    32, 31, 201, 185, 51, 225, 9, 88, 160, 45, 42, 233, 175, 244, 200, 223, 139, 207, 108, 200, 164,
    146, 32, 198, 124, 161, 164, 5, 230, 179, 158, 66, 125, 109, 255, 154, 103, 240, 184, 163, 24,
    187, 105, 80, 166, 143, 97, 132, 188, 222, 157, 116, 132, 137, 13, 36, 52, 213, 96, 48, 117, 83,
    49, 7, 123, 45, 71, 160, 0, 181, 210, 3, 118, 195, 79, 149, 36, 237, 240, 69, 64, 111, 19, 41,
    1, 104, 226, 107, 74, 6, 201, 46, 65, 238, 254, 231, 138, 14, 185, 181, 214, 229, 103, 26, 69,
    159, 176, 52, 7, 20, 76, 233, 89, 140, 109, 38, 110, 80, 139, 131, 113, 156, 22, 204, 84, 119,
    73, 88, 92, 185, 105, 88, 22, 175, 10, 146, 173, 76, 126, 111, 36, 100, 189, 27, 108, 55, 24,
    113, 108, 92, 133, 251, 217, 89, 50, 25, 154, 38, 133, 149, 141, 134, 171, 183, 203, 93, 24,
    169, 63, 247, 172, 145, 69, 49, 183, 100, 90, 122, 209, 103, 63, 106, 15, 62, 182, 254, 191, 12,
    135, 127, 59, 77, 162, 64, 230, 204, 14, 56, 202, 75, 203, 91, 66, 72, 126, 139, 101, 67, 206,
    243, 223, 170, 162, 192, 55, 180, 217, 65, 36, 217, 177, 137, 72, 160, 72, 1, 106, 45, 247, 137,
    136, 222, 94, 163, 125, 150, 225, 106, 106, 118, 195, 216, 16, 158, 35, 136, 55, 95, 109, 56,
    101, 9, 240, 190, 89, 145, 80, 183, 243, 140, 36, 16, 118, 208, 8, 21, 6, 235, 245, 221, 30,
    146, 99, 177, 60, 176, 97, 20, 139, 224, 95, 227, 2, 161, 238, 176, 23, 111, 8, 48, 63, 100, 98,
    15, 84, 244, 81, 108, 124, 104, 83, 150, 141, 157, 218, 36, 232, 118, 7, 19, 78, 14, 0, 91, 4,
    173, 152, 231, 114, 216, 104, 66, 39, 128, 236, 152, 205, 103, 79, 25, 68, 196, 9, 182, 85, 78,
    129, 112, 187, 0, 83, 140, 31, 192, 152, 88, 209, 199, 88, 132, 96, 187, 13, 72, 251, 109, 110,
    137, 246, 1, 69, 4, 11, 185, 47, 36, 155, 46, 9, 248, 253, 227, 51, 33, 204, 226, 64, 39, 33, 2,
    160, 192, 68, 47, 243, 183, 92, 236, 140, 181, 184, 80, 71, 86, 18, 69, 64, 216, 129, 157, 118,
    199, 72, 10, 0, 200, 129, 9, 122, 155, 221, 80, 14, 117, 157, 21, 231, 66, 145, 206, 125, 245,
    178, 120, 41, 222, 255, 57, 98, 181, 176, 0, 232, 118, 187, 84, 26, 225, 214, 194, 183, 35, 1,
    16, 62, 235, 47, 218, 201, 127, 192, 182, 105, 125, 36, 72, 186, 49, 20, 145, 2, 59, 166, 7,
    121, 49, 234, 185, 223, 169, 109, 0, 90, 71, 224, 210, 59, 162, 31, 31, 7, 117, 204, 1, 238, 19,
    193, 60, 30, 13, 0, 144, 72, 134, 139, 170, 221, 236, 6, 5, 135, 227, 162, 140, 189, 35, 159,
    122, 236, 151, 188, 119, 9, 248, 69, 157, 227, 160, 151, 141, 96, 172, 70, 204, 88, 156, 244,
    78, 61, 18, 129, 196, 120, 60, 46, 138, 36, 1, 143, 237, 156, 114, 131, 120, 215, 92, 108, 1,
    95, 39, 253, 230, 46, 145, 59, 68, 75, 108, 161, 22, 23, 243, 100, 194, 167, 149, 145, 33, 248,
    201, 54, 76, 57, 94, 107, 12, 92, 193, 238, 186, 184, 184, 184, 184, 184, 184, 184, 184, 92, 45,
    254, 7, 231, 170, 119, 13, 16, 28, 123, 189, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130,
  ],
};
